{% extends "console/base.html" %}

{% block title %}Monitoring - Ops Console{% endblock %}

{% block console_content %}
<h1 class="mb-4">System Monitoring</h1>

<div class="row">
  <!-- Host Information -->
  <div class="col-md-6 mb-4">
    <div class="card h-100">
      <div class="card-header">
        <strong>Host Information</strong>
      </div>
      <div class="card-body">
        <table class="table table-sm mb-0">
          <tbody>
            <tr>
              <td class="fw-semibold" style="width: 40%;">Hostname</td>
              <td><code>{{ host_info.hostname }}</code></td>
            </tr>
            <tr>
              <td class="fw-semibold">Platform</td>
              <td><code>{{ host_info.platform }}</code></td>
            </tr>
            <tr>
              <td class="fw-semibold">Python Version</td>
              <td><code>{{ host_info.python_version|truncatechars:50 }}</code></td>
            </tr>
            <tr>
              <td class="fw-semibold">Django Version</td>
              <td><code>{{ host_info.django_version }}</code></td>
            </tr>
            <tr>
              <td class="fw-semibold">Process ID</td>
              <td><code>{{ host_info.pid }}</code></td>
            </tr>
            <tr>
              <td class="fw-semibold">Working Directory</td>
              <td><code class="text-break">{{ host_info.cwd }}</code></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- SLURM Status -->
  <div class="col-md-6 mb-4">
    <div class="card h-100">
      <div class="card-header d-flex justify-content-between align-items-center">
        <strong>SLURM Cluster</strong>
        {% if slurm_status.mode == "fake" %}
        <span class="badge bg-warning">Fake Mode</span>
        {% else %}
        <span class="badge bg-info">Real Mode</span>
        {% endif %}
      </div>
      <div class="card-body">
        {% if slurm_status.mode == "fake" %}
        <div class="alert alert-warning mb-3">
          <strong>Development Mode:</strong> Running with FAKE_SLURM enabled. 
          Jobs are simulated locally.
        </div>
        {% endif %}
        
        <table class="table table-sm mb-0">
          <tbody>
            <tr>
              <td class="fw-semibold" style="width: 40%;">Mode</td>
              <td>
                <span class="badge {% if slurm_status.mode == 'fake' %}bg-warning{% else %}bg-info{% endif %}">
                  {{ slurm_status.mode|upper }}
                </span>
              </td>
            </tr>
            <tr>
              <td class="fw-semibold">Connected</td>
              <td>
                {% if slurm_status.connected == True %}
                <span class="text-success">Yes</span>
                {% elif slurm_status.connected == False %}
                <span class="text-danger">No</span>
                {% else %}
                <span class="text-muted">Unknown</span>
                {% endif %}
              </td>
            </tr>
            <tr>
              <td class="fw-semibold">Status</td>
              <td>{{ slurm_status.message }}</td>
            </tr>
          </tbody>
        </table>
        
        <hr>
        
        <div class="text-muted">
          <small>
            <em>Future expansion:</em> This section will show cluster nodes, 
            queue summary, and resource utilization when connected to a real 
            SLURM cluster.
          </small>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Disk Statistics -->
<div class="row">
  <div class="col-12 mb-4">
    <div class="card">
      <div class="card-header">
        <strong>Job Data Storage</strong>
      </div>
      <div class="card-body">
        {% if disk_stats.configured and disk_stats.exists %}
        <div class="row align-items-center">
          <div class="col-md-4">
            <p class="mb-2"><strong>Path:</strong></p>
            <code class="text-break">{{ disk_stats.path }}</code>
          </div>
          <div class="col-md-4">
            <p class="mb-2"><strong>Disk Usage:</strong></p>
            <div class="progress mb-2" style="height: 25px;">
              <div class="progress-bar {% if disk_stats.percent_used > 90 %}bg-danger{% elif disk_stats.percent_used > 75 %}bg-warning{% else %}bg-success{% endif %}" 
                   role="progressbar" 
                   style="width: {{ disk_stats.percent_used }}%;" 
                   aria-valuenow="{{ disk_stats.percent_used }}" 
                   aria-valuemin="0" 
                   aria-valuemax="100">
                {{ disk_stats.percent_used }}%
              </div>
            </div>
            <small class="text-muted">
              {{ disk_stats.used_gb }} GB used / {{ disk_stats.total_gb }} GB total
            </small>
          </div>
          <div class="col-md-4">
            <table class="table table-sm mb-0">
              <tbody>
                <tr>
                  <td>Free Space</td>
                  <td class="text-end"><strong>{{ disk_stats.free_gb }} GB</strong></td>
                </tr>
                <tr>
                  <td>Job Directories</td>
                  <td class="text-end"><strong>{{ disk_stats.job_directories }}</strong></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        {% elif disk_stats.error %}
        <div class="alert alert-danger mb-0">
          <strong>Error:</strong> {{ disk_stats.error }}
        </div>
        {% elif not disk_stats.configured %}
        <div class="alert alert-warning mb-0">
          <strong>Not Configured:</strong> JOB_BASE_DIR is not set in settings.
        </div>
        {% elif not disk_stats.exists %}
        <div class="alert alert-warning mb-0">
          <strong>Directory Missing:</strong> {{ disk_stats.path }} does not exist.
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Placeholder for future monitoring -->
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <strong>Future Monitoring Features</strong>
      </div>
      <div class="card-body text-muted">
        <p>This section is designed for future expansion. Planned features include:</p>
        <ul class="mb-0">
          <li>Real-time SLURM queue monitoring (squeue integration)</li>
          <li>Node availability and health status (sinfo integration)</li>
          <li>Resource utilization charts (CPU, memory, GPU)</li>
          <li>Job throughput metrics</li>
          <li>Alerting and notifications</li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}

